{% extends "base.html" %}

{% block title %}DHCP Configuration - Kapadokya NetBoot{% endblock %}

{% block page_title %}
    <i class="ti ti-router me-2"></i>DHCP Configuration
{% endblock %}

{% block page_actions %}
<div class="col-auto ms-auto d-print-none">
    <div class="d-flex align-items-center">
        <span class="me-3">
            <span class="status-indicator {% if dhcp_enabled %}active{% else %}inactive{% endif %}" data-service="dhcp"></span>
            <span class="fw-bold">{% if dhcp_enabled %}Active{% else %}Inactive{% endif %}</span>
        </span>
        <div class="form-check form-switch m-0">
            <input class="form-check-input" type="checkbox" {% if dhcp_enabled %}checked{% endif %} onchange="toggleService('dhcp', this)">
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="row row-deck row-cards">
    <!-- Current Configuration -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="ti ti-info-circle me-2"></i>
                    Current Configuration
                </h3>
                <div class="card-actions">
                    <a href="{{ url_for('dhcp_restart') }}" class="btn btn-primary" onclick="return confirm('Restart DHCP server?')">
                        <i class="ti ti-reload me-2"></i>
                        Restart DHCP
                    </a>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="datagrid">
                            <div class="datagrid-item">
                                <div class="datagrid-title">Network</div>
                                <div class="datagrid-content"><code>{{ config.network }}</code></div>
                            </div>
                            <div class="datagrid-item">
                                <div class="datagrid-title">Netmask</div>
                                <div class="datagrid-content"><code>{{ config.netmask }}</code></div>
                            </div>
                            <div class="datagrid-item">
                                <div class="datagrid-title">DHCP Range</div>
                                <div class="datagrid-content"><code>{{ config.range_start }} - {{ config.range_end }}</code></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="datagrid">
                            <div class="datagrid-item">
                                <div class="datagrid-title">Gateway</div>
                                <div class="datagrid-content"><code>{{ config.gateway }}</code></div>
                            </div>
                            <div class="datagrid-item">
                                <div class="datagrid-title">DNS Servers</div>
                                <div class="datagrid-content"><code>{{ config.dns }}</code></div>
                            </div>
                            <div class="datagrid-item">
                                <div class="datagrid-title">PXE Server (next-server)</div>
                                <div class="datagrid-content"><code>{{ config.next_server }}</code></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Configuration -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="ti ti-edit me-2"></i>
                    Edit DHCP Settings
                </h3>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('dhcp_update') }}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label required">Network Address</label>
                            <input type="text" class="form-control" name="network" value="{{ config.network }}" required pattern="(\d{1,3}\.){3}\d{1,3}" placeholder="192.168.122.0">
                            <small class="form-hint">Network address (e.g., 192.168.122.0)</small>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label required">Netmask</label>
                            <input type="text" class="form-control" name="netmask" value="{{ config.netmask }}" required pattern="(\d{1,3}\.){3}\d{1,3}" placeholder="255.255.255.0">
                            <small class="form-hint">Subnet mask (e.g., 255.255.255.0)</small>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label required">DHCP Range Start</label>
                            <input type="text" class="form-control" name="range_start" value="{{ config.range_start }}" required pattern="(\d{1,3}\.){3}\d{1,3}" placeholder="192.168.122.100">
                            <small class="form-hint">First IP in DHCP pool</small>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label required">DHCP Range End</label>
                            <input type="text" class="form-control" name="range_end" value="{{ config.range_end }}" required pattern="(\d{1,3}\.){3}\d{1,3}" placeholder="192.168.122.200">
                            <small class="form-hint">Last IP in DHCP pool</small>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label required">Gateway (Router)</label>
                            <input type="text" class="form-control" name="gateway" value="{{ config.gateway }}" required pattern="(\d{1,3}\.){3}\d{1,3}" placeholder="192.168.122.1">
                            <small class="form-hint">Default gateway IP</small>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label required">DNS Servers</label>
                            <input type="text" class="form-control" name="dns" value="{{ config.dns }}" required placeholder="192.168.122.1, 8.8.8.8">
                            <small class="form-hint">Comma-separated DNS IPs</small>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label required">PXE Server (next-server)</label>
                            <input type="text" class="form-control" name="next_server" value="{{ config.next_server }}" required pattern="(\d{1,3}\.){3}\d{1,3}" placeholder="192.168.122.20">
                            <small class="form-hint">TFTP/HTTP boot server IP</small>
                        </div>
                    </div>

                    <div class="card-footer">
                        <div class="d-flex">
                            <button type="submit" class="btn btn-primary">
                                <i class="ti ti-device-floppy me-2"></i>
                                Save Configuration
                            </button>
                            <a href="{{ url_for('index') }}" class="btn btn-link ms-auto">Cancel</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>
{% endblock %}
